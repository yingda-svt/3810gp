<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Assignment Details - <%= course.course_id %></title>
</head>
<body>
    <h1>Assignment: <%= assignment.title %></h1>
    <p>Due Date: <%= new Date(assignment.due_date).toLocaleString() %></p>

    <h2>Your Submission</h2>
    <% if (submission) { %>
        <p>Submitted on: <%= new Date(submission.submission_date).toLocaleString() %></p>
        <p>File: <a href="<%= submission.file_path %>" target="_blank">Download</a></p>
        <p>File Type: <%= submission.file_type %></p>
        <p>File Size: 
            <% 
                const sizeKB = (submission.file_size / 1024).toFixed(2);
                const sizeMB = (sizeKB / 1024).toFixed(2);
                const displaySize = sizeMB >= 1 ? `${sizeMB} MB` : `${sizeKB} KB`;
            %>
            <%= displaySize %>
        </p>
        <!-- 刪除提交 -->
        <form action="/submissions/delete" method="POST" style="display:inline;">
            <input type="hidden" name="submissionId" value="<%= submission._id %>" />
            <button type="submit" onclick="return confirm('Are you sure to delete this submission?');">Delete Submission</button>
        </form>
    <% } else { %>
        <p>No submission yet.</p>
        <!-- 上傳檔案表單 -->
        <form action="/submissions/create" method="POST" enctype="multipart/form-data">
            <input type="hidden" name="assignmentId" value="<%= assignment._id %>" />
            <input type="hidden" name="userId" value="<%= user.user_id %>" />
            <input type="file" name="submissionFile" required />
            <button type="submit">Upload Submission</button>
        </form>
    <% } %>

    <p><a href="/list">Back to list</a></p>
</body>
</html>
